---
title: 'MUSA500 Homework2: Using OLS Regression to Predict Median House Values in
  Philadelphia'
author: "Ling Chen, Hang Zhao, Jiahang Li"
date: "2023-10-16"
output:
  html_document:
  toc: yes
toc_float: yes
code_folding: hide
number_sections: yes
code_download: no
theme: united
highlight: espresso
pdf_document:
  toc: yes
editor_options:
  markdown:
  wrap: 72
---
  
  ```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)
```

```{r setup2, include=FALSE, echo=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set()

library(tidyr)
library(dplyr)
library(DAAG)
library(car)  #to calculate VIF
library(MASS)
library(rsq)
library(tidyverse) #for ggplot
library(sf) #for maps
library(cowplot) #for plotgrid
#library(classInt)#for jenks breaks
library(ggplot2)
library(RColorBrewer)
#library(broom)
library(r2symbols)
#library(lattice)
library(corrplot)
library(spdep)
library(tmap)

options(scipen=999)

data <- read.csv("C:/Users/jiahangl/OneDrive - PennO365/data mining/A1/RegressionData.csv")
data_geom <-st_read("C:/Users/jiahangl/OneDrive - PennO365/data mining/A1/Lecture 1 - RegressionData.shp.zip")

source("https://raw.githubusercontent.com/urbanSpatial/Public-Policy-Analytics-Landing/master/functions.r")

palette5 <- c("#AED6F1","#85C1E9","#3498DB","#2874A6","#1B4F72")

```

```{r, warning = FALSE, message = FALSE}
newqBr <- function(df, variable, rnd) {
  if (missing(rnd)) {
    as.character(quantile(round(df[[variable]],4),
                          c(.01,.2,.4,.6,.8), na.rm=T))
  } else if (rnd == FALSE | rnd == F) {
    as.character(formatC(quantile(df[[variable]],
                                  c(.01,.2,.4,.6,.8), na.rm=T),
                         digits = 3))
  }
}
```

# **Introduction**

Philadelphia, renowned for its rich history and pulsating present, is home to a continually evolving real estate environment. However, a study by the Economic League reveals a nuanced picture: the overall proportion of Philadelphia households grappling with housing cost burden experienced a decrease from 29.8% to 26.7% between 2016 and 2021(Economic League, 2023). Nevertheless, this alteration in cost burden manifested divergently across various income brackets. Considering housing is a fundamental human necessity, ensuring affordability is crucial for maintaining well-being and quality of life. Consequently, comprehending the factors that influence housing values is essential for exerting better control over the housing market and making more strategic, informed decisions.


This report aims to explore the relationship between median house values and various neighborhood characteristics within the city of Philadelphia. 


# **Methods**
```{r}
queen <- poly2nb(data_geom , queen=TRUE)
queenlist<-nb2listw(queen, style = 'W')
moran(data_geom$LNMEDHVAL, queenlist, n=length(queenlist$neighbours), S0=Szero(queenlist))$`I` 

```

```{r warning=FALSE, message=FALSE, cache=FALSE}
moranMC<-moran.mc(data_geom$LNMEDHVAL, queenlist, nsim=999, alternative="two.sided")  #We use 999 permutations
moranMC
```
```{r warning=FALSE, message=FALSE, cache=FALSE}
moranMCres<-moranMC$res
hist(moranMCres, freq=10000000, nclass=100)   #Draws distribution of Moran's I's calculated from randomly permuted values
# Here, we draw a red vertical line at the observed value of our Moran's I
abline(v=moran(data_geom$LNMEDHVAL, queenlist, n=length(queenlist$neighbours), S0=Szero(queenlist))$`I`, col='red')  
```

```

